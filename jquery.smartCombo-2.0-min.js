/*
* Convierte un combo multiple en botones clickeables
* author: upadrian@gmail.com
* version 2.0 08/2013
* http://upadrian.github.com/smartcombo
* jscompress by http://jscompress.com
*	
*/
(function(e,t,n,r){"use strict";function o(t,n){this.element=t;this.$element=e(t);this.sourceNode=this.$element.get(0);this.settings=e.extend({},s,n);this._defaults=s;this._name=i;this.initDone=false;if(!this.$element.attr("id"))e.error("smartCombo needs ID attribute.");if(this.$element.prop("tagName")!="SELECT")e.error("smartCombo only be applied to a SELECT tag ("+this.$element.prop("tagName")+")");this.props={multiple:this.$element.attr("multiple")?true:false,destID:"sc_"+this.$element.attr("id"),_ulClass:this.settings._class+"_ul",_liClass:this.settings._class+"_li",_labelClass:this.settings._class+"_label",_footerDivClass:this.settings._class+"_footer",_footerAbt:this.settings._class+"_footerBT",_footerBTall:this.settings._class+"_footerBTall",_footerBTnone:this.settings._class+"_footerBTnone",_liClassOptGroup:this.settings._class+"_optGroup",_liClassOptGroupLabel:this.settings._class+"_optGroupLabel",_wrapperClass:this.settings._class+"_wrapper",_optionSelectedClass:this.settings._class+"_optionSelectedClass",_optgroupSelectedClass:this.settings._class+"_optgroupSelectedClass",_enabledClass:this.settings._class+"_enabled",_disabledClass:this.settings._class+"_disabled",disabled:false};this.init();this.setActions();this.setEvents();this.$element.data("plugin_"+i+"_context",this)}var i="smartCombo",s={_class:"sc",_text_labelSimple:"Seleccione una opción",_text_labelMultiple:"Seleccione opciones",_open:false,_wrapperPosition:"absolute",_closeOnClick:true,_openOnMouseEnter:true,_closeOnMouseLeave:true,reArmOnLoad:true,setAllSelectedTofalse:false,_initialState:"close",showSelectedLabels:true};o.prototype={_public:{_parent:{},enable:function(e){var e=e||this._parent;e.props.disabled=false;e.sc.removeClass(e.props._disabledClass);e.sc.addClass(e.props._enabledClass)},disable:function(e){var e=e||this._parent;e.props.disabled=true;e.sc.removeClass(e.props._enabledClass);e.sc.addClass(e.props._disabledClass)},reArmFromSource:function(t){var t=t||this._parent,n=[],r;for(r=0;r<t.sourceNode.options.length;r++)if(t.sourceNode.options.item(r).selected)n.push(String(r));t.sc_options.each(function(){if(jQuery.inArray(e(this).attr("index"),n)!=-1)e(this).addClass(t.props._optionSelectedClass);else e(this).removeClass(t.props._optionSelectedClass)});t.sc_optgroups.each(function(){var n=e(this),r=true;e("."+t.props._liClass+" a",n).each(function(){if(!e(this).hasClass(t.props._optionSelectedClass))r=false});if(r)n.data("seleccionado",true).children("a").addClass(t.props._optgroupSelectedClass);else n.data("seleccionado",false).children("a").removeClass(t.props._optgroupSelectedClass)});if(!t.props.multiple&&t.settings._closeOnClick)t.settings._open=t.closeWrapper();t.populateLabels()}},init:function(){this._public._parent=this;var t=this;var n="";n+='<div id="'+this.props.destID+'" class="'+this.settings._class+'">';n+='	<div class="'+this.props._labelClass+'">';n+='		<a href="javascript:;" title="'+(this.props.multiple?this.settings._text_labelMultiple:this.settings._text_labelSimple)+'">'+(this.props.multiple?this.settings._text_labelMultiple:this.settings._text_labelSimple)+"</a>";n+="	</div>";n+='	<div class="'+this.props._wrapperClass+'" style="position:'+this.settings._wrapperPosition+'">';n+='		<ul class="'+this.props._ulClass+'">';this.$element.children("optgroup,option").each(function(){n+=t.getNode(e(this))});n+="		</ul>";n+="	</div>";n+="</div>";this.$element.css("display","none").after(n);this.sc=e("#"+this.props.destID);this.sc_options=e("."+this.props._liClass+" a",this.sc);this.sc_label=e("."+this.props._labelClass+" a",this.sc);this.sc_optgroups=e("."+this.props._liClassOptGroup+" a",this.sc);this.sc_optgroups_labels=e("."+this.props._liClassOptGroupLabel,this.sc);this.wrapper=e("."+this.props._wrapperClass,this.sc);this.hasOptgrups=e("optgroup",this.$element).length>0?true:false;this.optgroups=e("optgroup",this.$element);this.options=e("option",this.$element)},getNode:function(t){var n=this;var r="",i=t.get(0);if(i.tagName=="OPTGROUP"){r+='<li class="'+this.props._liClassOptGroup+'">';if(this.props.multiple)r+='	<a href="javascript:;" class="'+this.props._liClassOptGroupLabel+'" title="'+t.attr("label")+'">'+t.attr("label")+"</a>";else r+='	<span class="'+this.props._liClassOptGroupLabel+'" >'+t.attr("label")+"</span>";r+="	<ul>";t.children("option").each(function(){r+=n.getNode(e(this))});r+="	</ul>";r+="</li>"}else{r+='<li class="'+this.props._liClass+'" val="'+t.val()+'">';r+='	<a href="javascript:;" inheritedValue="'+t.val()+'" index="'+i.index+'">';r+="		<span>";r+=t.html();r+="		</span>";r+="	</a>";r+="</li>"}return r},setActions:function(){var t=this;this.sc_label.click(function(){if(t.settings._closeOnClick&&!t.props.disabled)t.settings._open=t.settings._open?t.closeWrapper():t.openWrapper()});this.sc_options.click(function(){if(!t.props.disabled)t.clickOnOption(e(this))});if(this.props.multiple){this.sc_optgroups_labels.click(function(){if(!t.props.disabled)t.clickOnOptGroup(e(this).parent())})}},setEvents:function(){var e=this;if(this.settings._openOnMouseEnter)this.sc.bind("mouseenter",function(){if(!e.props.disabled)e.settings._open=e.openWrapper()});if(this.settings._closeOnMouseLeave&&this.settings._closeOnClick)this.sc.bind("mouseleave",function(){if(!e.props.disabled)e.settings._open=e.closeWrapper()});this._public.reArmFromSource();if(this.settings._initialState=="open")this.openWrapper()},destroy:function(){},populateLabels:function(){var t=[];e("."+this.props._optionSelectedClass+" span",this.sc).each(function(){t.push(e(this).html())});this.sc.data("labels",t);var n=t.join(", ");if(n==""){this.sc_label.removeClass("selected");n=this.props.multiple?this.settings._text_labelMultiple:this.settings._text_labelSimple}else this.sc_label.addClass("selected");if(this.settings.showSelectedLabels)this.sc_label.html(n);this.sc_label.attr("title",n)},clickOnOptGroup:function(t){var n=this;if(!n.props.disabled){if(t.data("seleccionado")){e("."+this.props._liClass+" a",t).removeClass(this.props._optionSelectedClass);t.data("seleccionado",false).children("a").removeClass(this.props._optgroupSelectedClass)}else{e("."+this.props._liClass+" a",t).addClass(this.props._optionSelectedClass);t.data("seleccionado",true).children("a").addClass(this.props._optgroupSelectedClass)}this.populateLabels();this.updateSelect()}},updateSelect:function(){var t=this,n=[],r;this.sc_options.each(function(){if(e(this).hasClass(t.props._optionSelectedClass))n.push(e(this).attr("index"))});for(r=0;r<this.sourceNode.options.length;r++)this.sourceNode.options.item(r).selected=jQuery.inArray(String(r),n)!=-1?true:false;this._public.reArmFromSource();this.$element.change()},openWrapper:function(){if(!this.props.disabled){this.wrapper.css("display","block");return true}else return this.settings._open},closeWrapper:function(){if(!this.props.disabled){this.wrapper.css("display","none");return false}else return this.settings._open},clickOnOption:function(t){var n=this;if(!n.props.disabled){if(!this.props.multiple){this.sc_options.removeClass(this.props._optionSelectedClass);if(this.settings._closeOnClick)this.settings._open=this.closeWrapper()}if(t.hasClass(this.props._optionSelectedClass))t.removeClass(this.props._optionSelectedClass);else t.addClass(this.props._optionSelectedClass);var r=t.parent().parent().parent();if(r.length>0){var i=true;e("."+this.props._liClass+" a",r).each(function(){if(!e(this).hasClass(n.props._optionSelectedClass))i=false});if(i)r.data("seleccionado",true).children("a").addClass(this.props._optgroupSelectedClass);else r.data("seleccionado",false).children("a").removeClass(this.props._optgroupSelectedClass)}this.populateLabels();this.updateSelect()}}};e.fn[i]=function(t,n){return this.each(function(){if(!e.data(this,"plugin_"+i))e.data(this,"plugin_"+i,new o(this,t));else{if(typeof e(this).data("plugin_"+i)._public[t]==="function"){e(this).data("plugin_"+i)._public[t](e(this).data("plugin_"+i+"_context"),n)}else e.error("Method "+t+" does not exist on jQuery.smartCombo")}})}})(jQuery,window,document)