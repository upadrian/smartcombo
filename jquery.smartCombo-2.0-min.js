/*
* http://upadrian.github.com/smartcombo	
*/
!function(s){"use strict";function t(t,l){this.element=t,this.$element=s(t),this.sourceNode=this.$element.get(0),this.settings=s.extend({},i,l),this._defaults=i,this._name=e,this.initDone=!1,this.$element.attr("id")||s.error("smartCombo needs ID attribute."),"SELECT"!=this.$element.prop("tagName")&&s.error("smartCombo only be applied to a SELECT tag ("+this.$element.prop("tagName")+")"),this.props={multiple:this.$element.attr("multiple")?!0:!1,destID:"sc_"+this.$element.attr("id"),_ulClass:this.settings._class+"_ul",_liClass:this.settings._class+"_li",_labelClass:this.settings._class+"_label",_footerDivClass:this.settings._class+"_footer",_footerAbt:this.settings._class+"_footerBT",_footerBTall:this.settings._class+"_footerBTall",_footerBTnone:this.settings._class+"_footerBTnone",_liClassOptGroup:this.settings._class+"_optGroup",_liClassOptGroupLabel:this.settings._class+"_optGroupLabel",_wrapperClass:this.settings._class+"_wrapper",_optionSelectedClass:this.settings._class+"_optionSelectedClass",_optgroupSelectedClass:this.settings._class+"_optgroupSelectedClass",_enabledClass:this.settings._class+"_enabled",_disabledClass:this.settings._class+"_disabled",disabled:!1},this.init(),this.setActions(),this.setEvents(),this.$element.data("plugin_"+e+"_context",this)}var e="smartCombo",i={_class:"sc",_text_labelSimple:"Seleccione una opci√≥n",_text_labelMultiple:"Seleccione opciones",_open:!1,_wrapperPosition:"absolute",_closeOnClick:!0,_openOnMouseEnter:!0,_closeOnMouseLeave:!0,reArmOnLoad:!0,setAllSelectedTofalse:!1,_initialState:"close",showSelectedLabels:!0};t.prototype={_public:{_parent:{},destroy:function(){var s=s||this._parent;s.sc.remove(),s.$element.toggle().removeData("plugin_smartCombo").removeData("plugin_smartCombo_context")},enable:function(s){var s=s||this._parent;s.props.disabled=!1,s.sc.removeClass(s.props._disabledClass),s.sc.addClass(s.props._enabledClass)},disable:function(s){var s=s||this._parent;s.props.disabled=!0,s.sc.removeClass(s.props._enabledClass),s.sc.addClass(s.props._disabledClass)},reArmFromSource:function(t){var e,t=t||this._parent,i=[];for(e=0;e<t.sourceNode.options.length;e++)t.sourceNode.options.item(e).selected&&i.push(String(e));t.sc_options.each(function(){-1!=jQuery.inArray(s(this).attr("index"),i)?s(this).addClass(t.props._optionSelectedClass):s(this).removeClass(t.props._optionSelectedClass)}),t.sc_optgroups.each(function(){var e=s(this),i=!0;s("."+t.props._liClass+" a",e).each(function(){s(this).hasClass(t.props._optionSelectedClass)||(i=!1)}),i?e.data("seleccionado",!0).children("a").addClass(t.props._optgroupSelectedClass):e.data("seleccionado",!1).children("a").removeClass(t.props._optgroupSelectedClass)}),!t.props.multiple&&t.settings._closeOnClick&&(t.settings._open=t.closeWrapper()),t.populateLabels()}},init:function(){this._public._parent=this;var t=this,e="";e+='<div id="'+this.props.destID+'" class="'+this.settings._class+'">',e+='<div class="'+this.props._labelClass+'">',e+='<a href="javascript:;" title="'+(this.props.multiple?this.settings._text_labelMultiple:this.settings._text_labelSimple)+'">'+(this.props.multiple?this.settings._text_labelMultiple:this.settings._text_labelSimple)+"</a>",e+="</div>",e+='<div class="'+this.props._wrapperClass+'" style="position:'+this.settings._wrapperPosition+'">',e+='<ul class="'+this.props._ulClass+'">',this.$element.children("optgroup,option").each(function(){e+=t.getNode(s(this))}),e+="</ul>",e+="</div>",e+="</div>",this.$element.css("display","none").after(e),this.sc=s("#"+this.props.destID),this.sc_options=s("."+this.props._liClass+" a",this.sc),this.sc_label=s("."+this.props._labelClass+" a",this.sc),this.sc_optgroups=s("."+this.props._liClassOptGroup+" a",this.sc),this.sc_optgroups_labels=s("."+this.props._liClassOptGroupLabel,this.sc),this.wrapper=s("."+this.props._wrapperClass,this.sc),this.hasOptgrups=s("optgroup",this.$element).length>0?!0:!1,this.optgroups=s("optgroup",this.$element),this.options=s("option",this.$element)},getNode:function(t){var e=this,i="",l=t.get(0);return"OPTGROUP"==l.tagName?(i+='<li class="'+this.props._liClassOptGroup+'">',i+=this.props.multiple?'	<a href="javascript:;" class="'+this.props._liClassOptGroupLabel+'" title="'+t.attr("label")+'">'+t.attr("label")+"</a>":'<span class="'+this.props._liClassOptGroupLabel+'" >'+t.attr("label")+"</span>",i+="<ul>",t.children("option").each(function(){i+=e.getNode(s(this))}),i+="</ul>",i+="</li>"):(i+='<li class="'+this.props._liClass+'" val="'+t.val()+'">',i+='<a href="javascript:;" inheritedValue="'+t.val()+'" index="'+l.index+'">',i+="<span>",i+=t.html(),i+="</span>",i+="</a>",i+="</li>"),i},setActions:function(){var t=this;this.sc_label.click(function(){t.settings._closeOnClick&&!t.props.disabled&&(t.settings._open=t.settings._open?t.closeWrapper():t.openWrapper())}),this.sc_options.click(function(){t.props.disabled||t.clickOnOption(s(this))}),this.props.multiple&&this.sc_optgroups_labels.click(function(){t.props.disabled||t.clickOnOptGroup(s(this).parent())})},setEvents:function(){var s=this;this.settings._openOnMouseEnter&&this.sc.bind("mouseenter",function(){s.props.disabled||(s.settings._open=s.openWrapper())}),this.settings._closeOnMouseLeave&&this.settings._closeOnClick&&this.sc.bind("mouseleave",function(){s.props.disabled||(s.settings._open=s.closeWrapper())}),this._public.reArmFromSource(),"open"==this.settings._initialState&&this.openWrapper()},populateLabels:function(){var t=[];s("."+this.props._optionSelectedClass+" span",this.sc).each(function(){t.push(s(this).html())}),this.sc.data("labels",t);var e=t.join(", ");""==e?(this.sc_label.removeClass("selected"),e=this.props.multiple?this.settings._text_labelMultiple:this.settings._text_labelSimple):this.sc_label.addClass("selected"),this.settings.showSelectedLabels&&this.sc_label.html(e),this.sc_label.attr("title",e)},clickOnOptGroup:function(t){var e=this;e.props.disabled||(t.data("seleccionado")?(s("."+this.props._liClass+" a",t).removeClass(this.props._optionSelectedClass),t.data("seleccionado",!1).children("a").removeClass(this.props._optgroupSelectedClass)):(s("."+this.props._liClass+" a",t).addClass(this.props._optionSelectedClass),t.data("seleccionado",!0).children("a").addClass(this.props._optgroupSelectedClass)),this.populateLabels(),this.updateSelect())},updateSelect:function(){var t,e=this,i=[];for(this.sc_options.each(function(){s(this).hasClass(e.props._optionSelectedClass)&&i.push(s(this).attr("index"))}),t=0;t<this.sourceNode.options.length;t++)this.sourceNode.options.item(t).selected=-1!=jQuery.inArray(String(t),i)?!0:!1;this._public.reArmFromSource(),this.$element.change()},openWrapper:function(){return this.props.disabled?this.settings._open:(this.wrapper.css("display","block"),!0)},closeWrapper:function(){return this.props.disabled?this.settings._open:(this.wrapper.css("display","none"),!1)},clickOnOption:function(t){var e=this;if(!e.props.disabled){this.props.multiple||(this.sc_options.removeClass(this.props._optionSelectedClass),this.settings._closeOnClick&&(this.settings._open=this.closeWrapper())),t.hasClass(this.props._optionSelectedClass)?t.removeClass(this.props._optionSelectedClass):t.addClass(this.props._optionSelectedClass);var i=t.parent().parent().parent();if(i.length>0){var l=!0;s("."+this.props._liClass+" a",i).each(function(){s(this).hasClass(e.props._optionSelectedClass)||(l=!1)}),l?i.data("seleccionado",!0).children("a").addClass(this.props._optgroupSelectedClass):i.data("seleccionado",!1).children("a").removeClass(this.props._optgroupSelectedClass)}this.populateLabels(),this.updateSelect()}}},s.fn[e]=function(i,l){return this.each(function(){s.data(this,"plugin_"+e)?"function"==typeof s(this).data("plugin_"+e)._public[i]?s(this).data("plugin_"+e)._public[i](s(this).data("plugin_"+e+"_context"),l):s.error("Method "+i+" does not exist on jQuery.smartCombo"):s.data(this,"plugin_"+e,new t(this,i))})}}(jQuery,window,document);