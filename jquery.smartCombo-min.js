/*
 * http://upadrian.github.com/smartcombo
 */
!function(a,b,c,d){function g(b,c){this.element=b,this.$element=a(b),this.sourceNode=this.$element.get(0),this.settings=a.extend({},f,c),this._defaults=f,this._name=e,this.initDone=!1,this.$element.attr("id")||a.error("smartCombo needs ID attribute."),"SELECT"!=this.$element.prop("tagName")&&a.error("smartCombo only be applied to a SELECT tag ("+this.$element.prop("tagName")+")"),this.props={multiple:this.$element.prop("multiple"),destID:"sc_"+this.$element.attr("id"),_ulClass:"sc_ul",_liClass:"sc_li",_labelClass:"sc_label",_footerDivClass:"sc_footer",_footerAbt:"sc_footerBT",_footerBTall:"sc_footerBTall",_footerBTnone:"sc_footerBTnone",_liClassOptGroup:"sc_optGroup",_liClassOptGroupLabel:"sc_optGroupLabel",_wrapperClass:"sc_wrapper",_optionSelectedClass:"sc_optionSelectedClass",_optgroupSelectedClass:"sc_optgroupSelectedClass",_enabledClass:"sc_enabled",_disabledClass:"sc_disabled",_openedClass:"sc_opened",_closedClass:"sc_closed",disabled:!1},this.init(),this.setActions(),this.setEvents(),this._public.reArmFromSource(),this.settings.reArmOnLoad&&this.populateLabels(),"open"==this.settings._initialState&&this.openWrapper(),this.$element.data("plugin_"+e+"_context",this)}var e="smartCombo",f={_class:"sc",_text_labelSimple:"Seleccione una opci√≥n",_text_labelMultiple:"Seleccione opciones",_open:!1,_wrapperPosition:"absolute",_closeOnClick:!0,_openOnMouseEnter:!0,_closeOnMouseLeave:!0,reArmOnLoad:!0,setAllSelectedTofalse:!1,_initialState:"close",showSelectedLabels:!0,openMethod:"display",closeMethod:"display"};g.prototype={_public:{_parent:{},destroy:function(){var a=a||this._parent;a.sc.remove(),a.$element.toggle().removeData("plugin_smartCombo").removeData("plugin_smartCombo_context")},enable:function(a){a=a||this._parent,a.props.disabled=!1,a.sc.removeClass(a.props._disabledClass),a.sc.addClass(a.props._enabledClass)},disable:function(a){a=a||this._parent,a.props.disabled=!0,a.sc.removeClass(a.props._enabledClass),a.sc.addClass(a.props._disabledClass)},populateLabels:function(a){a=a||this._parent,a.populateLabels()},openWrapper:function(a){a=a||this._parent,a.openWrapper()},closeWrapper:function(a){a=a||this._parent,a.closeWrapper()},reArmFromSource:function(b){b=b||this._parent;var d,c=[];for(d=0;d<b.sourceNode.options.length;d++)b.sourceNode.options.item(d).selected&&c.push(String(d));b.sc_options.each(function(){jQuery.inArray(a(this).attr("index"),c)!=-1?a(this).addClass(b.props._optionSelectedClass):a(this).removeClass(b.props._optionSelectedClass)}),b.sc_optgroups.each(function(){var c=a(this),d=!0;a("."+b.props._liClass+" a",c).each(function(){a(this).hasClass(b.props._optionSelectedClass)||(d=!1)}),d?c.data("seleccionado",!0).children("a").addClass(b.props._optgroupSelectedClass):c.data("seleccionado",!1).children("a").removeClass(b.props._optgroupSelectedClass)}),!b.props.multiple&&b.settings._closeOnClick&&(b.settings._open=b.closeWrapper())}},init:function(){this._public._parent=this;var b=this,c="";c+='<div id="'+this.props.destID+'" class="'+this.settings._class+'">',c+='<div class="'+this.props._labelClass+'">',c+='<a href="javascript:;" title="'+(this.props.multiple?this.settings._text_labelMultiple:this.settings._text_labelSimple)+'">'+(this.props.multiple?this.settings._text_labelMultiple:this.settings._text_labelSimple)+"</a>",c+="</div>",c+='<div class="'+this.props._wrapperClass+" "+this.props._closedClass+'" style="position:'+this.settings._wrapperPosition+'">',c+='<ul class="'+this.props._ulClass+'">',this.$element.children("optgroup,option").each(function(){c+=b.getNode(a(this))}),c+="</ul>",c+="</div>",c+="</div>",this.$element.css("display","none").after(c),this.sc=a("#"+this.props.destID),this.sc_options=a("."+this.props._liClass+" a",this.sc),this.sc_label=a("."+this.props._labelClass+" a",this.sc),this.sc_optgroups=a("."+this.props._liClassOptGroup+" a",this.sc),this.sc_optgroups_labels=a("."+this.props._liClassOptGroupLabel,this.sc),this.wrapper=a("."+this.props._wrapperClass,this.sc),this.hasOptgrups=a("optgroup",this.$element).length>0,this.optgroups=a("optgroup",this.$element),this.options=a("option",this.$element)},getNode:function(b){var c=this,d="",e=b.get(0);if("OPTGROUP"==e.tagName)d+='<li class="'+this.props._liClassOptGroup+'">',d+=this.props.multiple?'<a href="javascript:;" class="'+this.props._liClassOptGroupLabel+'" title="'+b.attr("label")+'">'+b.attr("label")+"</a>":'<span class="'+this.props._liClassOptGroupLabel+'" >'+b.attr("label")+"</span>",d+="<ul>",b.children("option").each(function(){d+=c.getNode(a(this))}),d+="</ul>",d+="</li>";else{if(""==b.val()&&""==b.text())return"";d+='<li class="'+this.props._liClass+'" val="'+b.val()+'">',d+='<a href="javascript:;" inheritedValue="'+b.val()+'" index="'+e.index+'">',d+="<span>",d+=b.html(),d+="</span>",d+="</a>",d+="</li>"}return d},setActions:function(){var b=this;this.sc_label.click(function(){b.settings._closeOnClick&&!b.props.disabled&&(b.settings._open=b.settings._open?b.closeWrapper():b.openWrapper())}),this.sc_options.click(function(){b.props.disabled||b.clickOnOption(a(this))}),this.props.multiple&&this.sc_optgroups_labels.click(function(){b.props.disabled||b.clickOnOptGroup(a(this).parent())})},setEvents:function(){var a=this;this.settings._openOnMouseEnter&&this.sc.bind("mouseenter",function(){a.props.disabled||(a.settings._open=a.openWrapper())}),this.settings._closeOnMouseLeave&&this.settings._closeOnClick&&this.sc.bind("mouseleave",function(){a.props.disabled||(a.settings._open=a.closeWrapper())})},populateLabels:function(){var b=[];a("."+this.props._optionSelectedClass+" span",this.sc).each(function(){b.push(a(this).html())}),this.sc.data("labels",b);var c=b.join(", ");""==c?(this.sc_label.removeClass("selected"),c=this.props.multiple?this.settings._text_labelMultiple:this.settings._text_labelSimple):this.sc_label.addClass("selected"),this.settings.showSelectedLabels&&this.sc_label.html(c),this.sc_label.attr("title",c)},clickOnOptGroup:function(b){var c=this;c.props.disabled||(b.data("seleccionado")?(a("."+this.props._liClass+" a",b).removeClass(this.props._optionSelectedClass),b.data("seleccionado",!1).children("a").removeClass(this.props._optgroupSelectedClass)):(a("."+this.props._liClass+" a",b).addClass(this.props._optionSelectedClass),b.data("seleccionado",!0).children("a").addClass(this.props._optgroupSelectedClass)),this.populateLabels(),this.updateSelect())},updateSelect:function(){var d,b=this,c=[];for(this.sc_options.each(function(){a(this).hasClass(b.props._optionSelectedClass)&&c.push(a(this).attr("index"))}),d=0;d<this.sourceNode.options.length;d++)this.sourceNode.options.item(d).selected=jQuery.inArray(String(d),c)!=-1;this._public.reArmFromSource(),b.populateLabels(),this.$element.change()},openWrapper:function(){var b=this;if(this.props.disabled)return this.settings._open;switch(this.settings.openMethod){case"fade":this.wrapper.css({opacity:0,display:"block"}).stop(!0,!0).fadeIn(function(){a(this).addClass(b.props._openedClass).removeClass(b.props._closedClass)});break;case"slide":this.wrapper.stop(!0,!0).slideDown(function(){a(this).addClass(b.props._openedClass).removeClass(b.props._closedClass)});break;default:case"display":this.wrapper.css("display","block").addClass(b.props._openedClass).removeClass(b.props._closedClass)}return!0},closeWrapper:function(){var b=this;if(this.props.disabled)return this.settings._open;switch(this.settings.closeMethod){case"fade":this.wrapper.stop(!0,!0).fadeOut(function(){a(this).css("display","none").addClass(b.props._closedClass).removeClass(b.props._openedClass)});break;case"slide":this.wrapper.stop(!0,!0).slideUp(function(){a(this).addClass(b.props._closedClass).removeClass(b.props._openedClass)});break;default:case"display":this.wrapper.css("display","none").addClass(b.props._closedClass).removeClass(b.props._openedClass)}return!1},clickOnOption:function(b){var c=this;if(!c.props.disabled){this.props.multiple||(this.sc_options.removeClass(this.props._optionSelectedClass),this.settings._closeOnClick&&(this.settings._open=this.closeWrapper())),b.hasClass(this.props._optionSelectedClass)?b.removeClass(this.props._optionSelectedClass):b.addClass(this.props._optionSelectedClass);var d=b.parent().parent().parent();if(d.length>0){var e=!0;a("."+this.props._liClass+" a",d).each(function(){a(this).hasClass(c.props._optionSelectedClass)||(e=!1)}),e?d.data("seleccionado",!0).children("a").addClass(this.props._optgroupSelectedClass):d.data("seleccionado",!1).children("a").removeClass(this.props._optgroupSelectedClass)}this.populateLabels(),this.updateSelect()}}},a.fn[e]=function(b,c){return this.each(function(){a.data(this,"plugin_"+e)?"function"==typeof a(this).data("plugin_"+e)._public[b]?a(this).data("plugin_"+e)._public[b](a(this).data("plugin_"+e+"_context"),c):a.error("Method "+b+" does not exist on jQuery.smartCombo"):a.data(this,"plugin_"+e,new g(this,b))})}}(jQuery,window,document);