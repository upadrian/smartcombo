/*
* Convierte un combo multiple en botones clickeables
* author: upadrian@gmail.com
* version 1.5 07/2013
* http://upadrian.github.com/smartcombo
* jscompress by http://jscompress.com
*	
*/
(function(e){e.fn.smartCombo=function(t){var n={};var r={init:function(t){if(e(this).length==1)r.sc_init(e(this),t);else if(e(this).length>1)e(this).each(function(){e(this).smartCombo(t)})},sc_init:function(t,i){t.data("initDone",false);n.sourceJQO=t;n.sourceNode=n.sourceJQO.get(0);var s={_class:"sc",_text_labelSimple:"Seleccione una opción",_text_labelMultiple:"Seleccione opciones",_open:false,_wrapperPosition:"absolute",_closeOnClick:true,_openOnMouseEnter:false,_closeOnMouseLeave:true,reArmOnLoad:true,setAllSelectedTofalse:false,_initialState:"close",showSelectedLabels:true};n.settings=e.extend(s,i);n.props={multiple:n.sourceJQO.attr("multiple")?true:false,destID:"sc_"+n.sourceJQO.attr("id"),_ulClass:n.settings._class+"_ul",_liClass:n.settings._class+"_li",_labelClass:n.settings._class+"_label",_footerDivClass:n.settings._class+"_footer",_footerAbt:n.settings._class+"_footerBT",_footerBTall:n.settings._class+"_footerBTall",_footerBTnone:n.settings._class+"_footerBTnone",_liClassOptGroup:n.settings._class+"_optGroup",_liClassOptGroupLabel:n.settings._class+"_optGroupLabel",_wrapperClass:n.settings._class+"_wrapper",_optionSelectedClass:n.settings._class+"_optionSelectedClass",_optgroupSelectedClass:n.settings._class+"_optgroupSelectedClass"};var o="";o+='<div id="'+n.props.destID+'" class="'+n.settings._class+'">';o+='	<div class="'+n.props._labelClass+'">';o+='		<a href="javascript:;" title="'+(n.props.multiple?n.settings._text_labelMultiple:n.settings._text_labelSimple)+'">'+(n.props.multiple?n.settings._text_labelMultiple:n.settings._text_labelSimple)+"</a>";o+="	</div>";o+='	<div class="'+n.props._wrapperClass+'" style="position:'+n.settings._wrapperPosition+'">';o+='		<ul class="'+n.props._ulClass+'">';n.sourceJQO.children("optgroup,option").each(function(){o+=r.getNode(e(this))});o+="		</ul>";o+="	</div>";o+="</div>";n.sourceJQO.css("display","none").after(o);n.sc=e("#"+n.props.destID);n.sc_options=e("."+n.props._liClass+" a",n.sc);n.sc_label=e("."+n.props._labelClass+" a",n.sc);n.sc_optgroups=e("."+n.props._liClassOptGroup+" a",n.sc);n.sc_optgroups_labels=e("."+n.props._liClassOptGroupLabel,n.sc);n.wrapper=e("."+n.props._wrapperClass,n.sc);n.hasOptgrups=e("optgroup",n.sourceJQO).length>0?true:false;n.optgroups=e("optgroup",n.sourceJQO);n.options=e("option",n.sourceJQO);r.setActions()},getNode:function(t){var i="",s=t.get(0);if(s.tagName=="OPTGROUP"){i+='<li class="'+n.props._liClassOptGroup+'">';if(n.props.multiple)i+='	<a href="javascript:;" class="'+n.props._liClassOptGroupLabel+'" title="'+t.attr("label")+'">'+t.attr("label")+"</a>";else i+='	<span class="'+n.props._liClassOptGroupLabel+'" >'+t.attr("label")+"</span>";i+="	<ul>";t.children("option").each(function(){i+=r.getNode(e(this))});i+="	</ul>";i+="</li>"}else{i+='<li class="'+n.props._liClass+'" val="'+t.val()+'">';i+='	<a href="javascript:;" inheritedValue="'+t.val()+'" index="'+s.index+'">';i+="		<span>";i+=t.html();i+="		</span>";i+="	</a>";i+="</li>"}return i},setActions:function(){n.sc_label.click(function(){if(n.settings._closeOnClick)n.settings._open=n.settings._open?r.closeWrapper():r.openWrapper()});n.sc_options.click(function(){r.clickOnOption(e(this))});if(n.props.multiple){n.sc_optgroups_labels.click(function(){r.clickOnOptGroup(e(this).parent())})}r.setEvents()},setEvents:function(){if(n.settings._openOnMouseEnter)n.sc.bind("mouseenter",function(){n.settings._open=r.openWrapper()});if(n.settings._closeOnMouseLeave&&n.settings._closeOnClick)n.sc.bind("mouseleave",function(){n.settings._open=r.closeWrapper()});r.reArmFromSource();if(n.settings._initialState=="open")r.openWrapper()},destroy:function(){return this.each(function(){var t=e(this),n=t.data("smartCombo");t.removeData("smartCombo")})},populateLabels:function(){var t=[];e("."+n.props._optionSelectedClass+" span",n.sc).each(function(){t.push(e(this).html())});n.sc.data("labels",t);var r=t.join(", ");if(r=="")r=n.props.multiple?n.settings._text_labelMultiple:n.settings._text_labelSimple;if(n.settings.showSelectedLabels)n.sc_label.html(r);n.sc_label.attr("title",r)},reArmFromSource:function(){var t=[];for(vi=0;vi<n.sourceNode.options.length;vi++)if(n.sourceNode.options.item(vi).selected)t.push(String(vi));n.sc_options.each(function(){if(jQuery.inArray(e(this).attr("index"),t)!=-1)e(this).addClass(n.props._optionSelectedClass);else e(this).removeClass(n.props._optionSelectedClass)});n.sc_optgroups.each(function(){var t=e(this);ok=true;e("."+n.props._liClass+" a",t).each(function(){if(!e(this).hasClass(n.props._optionSelectedClass))ok=false});if(ok)t.data("seleccionado",true).children("a").addClass(n.props._optgroupSelectedClass);else t.data("seleccionado",false).children("a").removeClass(n.props._optgroupSelectedClass)});if(!n.props.multiple&&n.settings._closeOnClick)n.settings._open=r.closeWrapper();r.populateLabels()},clickOnOptGroup:function(t){if(t.data("seleccionado")){e("."+n.props._liClass+" a",t).removeClass(n.props._optionSelectedClass);t.data("seleccionado",false).children("a").removeClass(n.props._optgroupSelectedClass)}else{e("."+n.props._liClass+" a",t).addClass(n.props._optionSelectedClass);t.data("seleccionado",true).children("a").addClass(n.props._optgroupSelectedClass)}r.populateLabels();r.updateSelect()},updateSelect:function(){var t=[];n.sc_options.each(function(){if(e(this).hasClass(n.props._optionSelectedClass))t.push(e(this).attr("index"))});for(c=0;c<n.sourceNode.options.length;c++)n.sourceNode.options.item(c).selected=jQuery.inArray(String(c),t)!=-1?true:false;r.reArmFromSource();n.sourceJQO.change()},openWrapper:function(){n.wrapper.css("display","block");return true},closeWrapper:function(){n.wrapper.css("display","none");return false},clickOnOption:function(t){if(!n.props.multiple){n.sc_options.removeClass(n.props._optionSelectedClass);if(n.settings._closeOnClick)n.settings._open=r.closeWrapper()}if(t.hasClass(n.props._optionSelectedClass))t.removeClass(n.props._optionSelectedClass);else t.addClass(n.props._optionSelectedClass);var i=t.parent().parent().parent();if(i.length>0){var s=true;e("."+n.props._liClass+" a",i).each(function(){if(!e(this).hasClass(n.props._optionSelectedClass))s=false});if(s)i.data("seleccionado",true).children("a").addClass(n.props._optgroupSelectedClass);else i.data("seleccionado",false).children("a").removeClass(n.props._optgroupSelectedClass)}r.populateLabels();r.updateSelect()}};if(r[t])return r[t].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof t==="object"||!t)return r.init.apply(this,arguments);else e.error("Method "+t+" does not exist on jQuery.smartCombo")}})(jQuery)